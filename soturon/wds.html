<title>words history</title>
<script>
// sorted
var hist =
[ { wds: '5505', when: '2014/2/4 01:35:19' },
  { wds: '5505', when: '2014/2/4 00:54:43' },
  { wds: '5505', when: '2014/2/4 00:35:19' },
  { wds: '5465', when: '2014/2/3 23:35:19' },
  { wds: '5419', when: '2014/2/3 23:07:21' },
  { wds: '5329', when: '2014/2/3 22:35:19' },
  { wds: '5329', when: '2014/2/3 22:18:40' },
  { wds: '5299', when: '2014/2/3 21:35:19' },
  { wds: '5293', when: '2014/2/3 21:25:19' },
  { wds: '5302', when: '2014/2/3 20:58:51' },
  { wds: '5298', when: '2014/2/3 20:35:19' },
  { wds: '5298', when: '2014/2/3 19:35:19' },
  { wds: '5298', when: '2014/2/3 19:14:52' },
  { wds: '5277', when: '2014/2/3 19:07:05' },
  { wds: '5176', when: '2014/2/3 18:35:19' },
  { wds: '5173', when: '2014/2/3 18:07:51' },
  { wds: '5008', when: '2014/2/3 17:35:18' },
  { wds: '5008', when: '2014/2/3 16:35:18' },
  { wds: '5006', when: '2014/2/3 15:49:34' },
  { wds: '5016', when: '2014/2/3 15:35:18' },
  { wds: '4997', when: '2014/2/3 14:35:18' },
  { wds: '5009', when: '2014/2/3 13:42:25' },
  { wds: '5001', when: '2014/2/3 13:35:49' },
  { wds: '5001', when: '2014/2/3 13:35:18' },
  { wds: '4950', when: '2014/2/3 13:28:41' },
  { wds: '4950', when: '2014/2/3 13:00:10' },
  { wds: '4946', when: '2014/2/3 12:35:18' },
  { wds: '4946', when: '2014/2/3 12:34:49' },
  { wds: '4946', when: '2014/2/3 12:33:55' },
  { wds: '4946', when: '2014/2/3 11:35:18' },
  { wds: '4946', when: '2014/2/3 10:35:18' },
  { wds: '4946', when: '2014/2/3 09:35:18' },
  { wds: '4946', when: '2014/2/3 09:04:06' },
  { wds: '4863', when: '2014/2/3 08:35:18' },
  { wds: '4831', when: '2014/2/3 07:41:11' },
  { wds: '4822', when: '2014/2/3 06:38:01' },
  { wds: '4822', when: '2014/2/3 05:38:01' },
  { wds: '4822', when: '2014/2/3 04:38:01' },
  { wds: '4822', when: '2014/2/3 03:38:01' },
  { wds: '4822', when: '2014/2/3 02:38:01' },
  { wds: '4822', when: '2014/2/3 01:38:01' },
  { wds: '4822', when: '2014/2/3 00:38:01' },
  { wds: '4822', when: '2014/2/2 23:38:02' },
  { wds: '4820', when: '2014/2/2 23:03:41' },
  { wds: '4820', when: '2014/2/2 23:03:33' },
  { wds: '4820', when: '2014/2/2 23:03:00' },
  { wds: '4804', when: '2014/2/2 22:58:23' },
  { wds: '4804', when: '2014/2/2 22:38:01' },
  { wds: '4754', when: '2014/2/2 22:19:08' },
  { wds: '4754', when: '2014/2/2 22:15:57' },
  { wds: '4690', when: '2014/2/2 21:55:25' },
  { wds: '4660', when: '2014/2/2 21:46:05' },
  { wds: '4622', when: '2014/2/2 21:38:01' },
  { wds: '4570', when: '2014/2/2 21:07:24' },
  { wds: '4496', when: '2014/2/2 20:38:01' },
  { wds: '4351', when: '2014/2/2 19:52:49' },
  { wds: '4351', when: '2014/2/2 19:38:01' },
  { wds: '4327', when: '2014/2/2 19:20:38' },
  { wds: '4327', when: '2014/2/2 14:17:08' },
  { wds: '4315', when: '2014/2/2 12:39:46' },
  { wds: '4270', when: '2014/2/2 12:03:13' },
  { wds: '4252', when: '2014/2/2 10:44:54' },
  { wds: '4252', when: '2014/2/2 10:07:59' },
  { wds: '4252', when: '2014/2/2 09:44:53' },
  { wds: '4252', when: '2014/2/2 08:44:55' },
  { wds: '4252', when: '2014/2/2 07:44:53' },
  { wds: '4252', when: '2014/2/2 06:44:51' },
  { wds: '4252', when: '2014/2/2 05:42:45' },
  { wds: '4252', when: '2014/2/2 04:42:46' },
  { wds: '4252', when: '2014/2/2 03:42:45' },
  { wds: '4252', when: '2014/2/2 02:42:43' },
  { wds: '4252', when: '2014/2/2 01:42:45' },
  { wds: '4252', when: '2014/2/2 00:42:43' },
  { wds: '4252', when: '2014/2/1 23:29:56' },
  { wds: '4252', when: '2014/2/1 22:01:37' },
  { wds: '4252', when: '2014/2/1 21:39:39' },
  { wds: '4252', when: '2014/2/1 20:39:41' },
  { wds: '4252', when: '2014/2/1 19:40:24' },
  { wds: '4252', when: '2014/2/1 19:28:10' },
  { wds: '4192', when: '2014/2/1 18:59:06' },
  { wds: '4076', when: '2014/2/1 16:43:08' },
  { wds: '4053', when: '2014/2/1 15:43:09' },
  { wds: '4053', when: '2014/2/1 14:44:51' },
  { wds: '4053', when: '2014/2/1 14:43:10' },
  { wds: '4053', when: '2014/2/1 13:43:08' },
  { wds: '4053', when: '2014/2/1 12:43:08' },
  { wds: '4053', when: '2014/2/1 11:41:00' },
  { wds: '4053', when: '2014/2/1 11:04:14' },
  { wds: '4053', when: '2014/2/1 10:41:00' },
  { wds: '4053', when: '2014/2/1 09:41:00' },
  { wds: '4053', when: '2014/2/1 08:41:00' },
  { wds: '4053', when: '2014/2/1 07:41:00' },
  { wds: '4053', when: '2014/2/1 06:41:02' },
  { wds: '4053', when: '2014/2/1 05:26:56' },
  { wds: '4049', when: '2014/2/1 04:29:22' },
  { wds: '4049', when: '2014/2/1 04:09:14' },
  { wds: '4049', when: '2014/2/1 03:59:23' },
  { wds: '4049', when: '2014/2/1 03:47:48' },
  { wds: '4049', when: '2014/2/1 03:09:14' },
  { wds: '4049', when: '2014/2/1 03:03:19' },
  { wds: '4049', when: '2014/2/1 02:39:23' },
  { wds: '4049', when: '2014/2/1 01:41:07' },
  { wds: '4049', when: '2014/2/1 00:49:21' },
  { wds: '4049', when: '2014/2/1 00:41:07' },
  { wds: '4049', when: '2014/1/31 23:40:59' },
  { wds: '4049', when: '2014/1/31 22:40:59' },
  { wds: '4049', when: '2014/1/31 22:33:23' },
  { wds: '4049', when: '2014/1/31 21:41:08' },
  { wds: '4049', when: '2014/1/31 21:40:59' },
  { wds: '4049', when: '2014/1/31 20:41:03' },
  { wds: '4049', when: '2014/1/31 19:41:01' },
  { wds: '4049', when: '2014/1/31 18:57:32' },
  { wds: '4049', when: '2014/1/31 18:41:00' },
  { wds: '4049', when: '2014/1/31 18:20:57' },
  { wds: '4049', when: '2014/1/31 17:38:51' },
  { wds: '4049', when: '2014/1/31 16:38:53' },
  { wds: '4049', when: '2014/1/31 15:38:50' },
  { wds: '4049', when: '2014/1/31 14:38:50' },
  { wds: '4049', when: '2014/1/31 13:38:53' },
  { wds: '4049', when: '2014/1/31 13:12:10' },
  { wds: '4049', when: '2014/1/31 12:38:50' },
  { wds: '4049', when: '2014/1/31 11:09:43' },
  { wds: '4049', when: '2014/1/31 10:12:00' },
  { wds: '4049', when: '2014/1/31 10:09:43' },
  { wds: '4049', when: '2014/1/31 09:53:19' },
  { wds: '4049', when: '2014/1/31 09:10:04' },
  { wds: '4049', when: '2014/1/31 09:06:19' },
  { wds: '4049', when: '2014/1/31 08:54:26' },
  { wds: '4049', when: '2014/1/31 08:50:42' },
  { wds: '4049', when: '2014/1/31 08:50:11' },
  { wds: '4049', when: '2014/1/31 08:27:02' },
  { wds: '4049', when: '2014/1/31 08:26:36' },
  { wds: '4049', when: '2014/1/30 19:32:47' },
  { wds: '4049', when: '2014/1/30 19:04:58' },
  { wds: '4049', when: '2014/1/30 18:11:23' },
  { wds: '4049', when: '2014/1/30 17:42:53' },
  { wds: '4049', when: '2014/1/30 17:20:51' },
  { wds: '4049', when: '2014/1/30 16:36:03' },
  { wds: '2744', when: '2014/1/30 13:47:08' },
  { wds: '2744', when: '2014/1/29 17:40:25' },
  { wds: '2600', when: '2014/1/29 04:29:57' },
  { wds: '2366', when: '2014/1/28 20:00:48' },
  { wds: '2333', when: '2014/1/28 16:01:55' },
  { wds: '2190', when: '2014/1/28 14:56:17' },
  { wds: '2197', when: '2014/1/27 15:19:57' },
  { wds: '2197', when: '2014/1/27 15:06:30' },
  { wds: '2197', when: '2014/1/27 14:25:27' },
  { wds: '2197', when: '2014/1/27 14:20:09' },
  { wds: '2171', when: '2014/1/27 12:56:11' },
  { wds: '2173', when: '2014/1/27 03:52:01' },
  { wds: '2173', when: '2014/1/26 22:02:06' },
  { wds: '2173', when: '2014/1/26 21:54:50' },
  { wds: '2090', when: '2014/1/26 19:59:32' },
  { wds: '2085', when: '2014/1/26 19:33:13' },
  { wds: '1876', when: '2014/1/26 18:47:40' },
  { wds: '1863', when: '2014/1/26 16:28:29' },
  { wds: '1863', when: '2014/1/26 16:23:58' },
  { wds: '1866', when: '2014/1/26 15:47:41' },
  { wds: '1858', when: '2014/1/26 09:53:31' },
  { wds: '1726', when: '2014/1/26 02:31:23' },
  { wds: '1686', when: '2014/1/26 01:23:53' },
  { wds: '1686', when: '2014/1/26 01:21:18' },
  { wds: '1660', when: '2014/1/25 23:41:27' },
  { wds: '1613', when: '2014/1/25 22:44:06' },
  { wds: '1613', when: '2014/1/25 21:46:16' },
  { wds: '1613', when: '2014/1/25 18:59:00' },
  { wds: '1613', when: '2014/1/25 18:52:27' },
  { wds: '1613', when: '2014/1/25 18:50:15' },
  { wds: '1613', when: '2014/1/25 15:53:47' },
  { wds: '1613', when: '2014/1/25 15:52:39' },
  { wds: '1613', when: '2014/1/25 13:43:27' },
  { wds: '1610', when: '2014/1/25 13:41:17' },
  { wds: '1579', when: '2014/1/25 03:54:13' },
  { wds: '1579', when: '2014/1/25 03:50:16' },
  { wds: '1579', when: '2014/1/25 00:50:36' },
  { wds: '1579', when: '2014/1/24 21:50:23' },
  { wds: '1579', when: '2014/1/24 21:06:21' },
  { wds: '1579', when: '2014/1/24 20:51:34' },
  { wds: '1543', when: '2014/1/24 19:47:55' },
  { wds: '1375', when: '2014/1/24 18:32:31' },
  { wds: '1389', when: '2014/1/24 14:52:08' },
  { wds: '1389', when: '2014/1/24 14:18:17' },
  { wds: '1388', when: '2014/1/24 12:49:07' },
  { wds: '1335', when: '2014/1/24 09:48:36' },
  { wds: '1335', when: '2014/1/24 08:50:03' },
  { wds: '1335', when: '2014/1/24 08:49:41' },
  { wds: '1330', when: '2014/1/24 06:49:19' },
  { wds: '1275', when: '2014/1/24 06:34:57' },
  { wds: '1261', when: '2014/1/24 06:22:20' },
  { wds: '1140', when: '2014/1/24 02:02:33' },
  { wds: '1140', when: '2014/1/23 22:24:12' },
  { wds: '1140', when: '2014/1/23 17:55:48' },
  { wds: '1140', when: '2014/1/23 17:54:20' },
  { wds: '1140', when: '2014/1/23 17:52:07' },
  { wds: '1112', when: '2014/1/23 16:50:19' },
  { wds: '1028', when: '2014/1/23 15:26:03' },
  { wds: '1042', when: '2014/1/23 14:42:35' },
  { wds: '996', when: '2014/1/23 13:51:51' },
  { wds: '996', when: '2014/1/23 12:32:26' },
  { wds: '975', when: '2014/1/23 05:10:16' },
  { wds: '975', when: '2014/1/23 01:24:57' },
  { wds: '943', when: '2014/1/23 00:50:19' },
  { wds: '940', when: '2014/1/23 00:20:32' } ]
</script>
</head><body>
<canvas id="C"
  width="1600px" height="900px"
  style="border:1px solid black;width:100%;height:100%"></canvas>
<script>
var ctx = C.getContext('2d');

for (var i=0; i < hist.length; ++i) {
  hist[i].time = (new Date(hist[i].when)).getTime();
}

var transX = (function() {
  var margin = 50;
  var a = hist[hist.length-1].time
    , b = hist[0].time
    , W = C.width - margin * 2;
  return function(x) {
    return (x-a) * W / (b-a) + margin;
  };
})();

var transY = (function() {
  var margin = 50;
  var a = hist[hist.length-1].wds
    , b = hist[0].wds
    , H = C.height - margin * 2;
  return function(x) {
    return H - (x-a) * H / (b-a) + margin;
  };
})();

function draw() {

  ctx.beginPath();
  ctx.moveTo(transX(hist[hist.length-1].time), transY(hist[hist.length-1].wds));
  for (var i = hist.length-1; i >= 0; --i) {
    ctx.lineTo(transX(hist[i].time), transY(hist[i].wds));
  }
  ctx.strokeStyle = "black";
  ctx.lineWidth = '1.5';
  ctx.stroke();

  (function() {
    var last = -1000;
    for (var i = hist.length-1; i>=0; --i) {

      var x = transX(hist[i].time);
      if (x - last < 100) continue;

      ctx.fillText('^' + hist[i].when.split(' ')[0]
                 , x, C.height);
      last = x;
    }
  })();

  (function() {
    for (var i = 950; i<5550; i+= 250) {
      var idx = ('00'+i).slice(-4);
      ctx.fillText(idx, 0, transY(i));
      ctx.fillText(idx, C.width-40, transY(i));
    }
  })();
}

draw();

C.onmousemove = function (e) {
  var idx = nearest((e.clientX-C.offsetLeft) * 1600 / C.clientWidth);

  var x = transX(hist[idx].time)
    , y = transY(hist[idx].wds);


  ctx.clearRect(0, 0, C.width, C.height);

  ctx.strokeStyle = '#f0a000';
  ctx.lineWidth = '0.5';
  ctx.beginPath();
  ctx.moveTo(0, y); ctx.lineTo(C.width, y); ctx.stroke();
  ctx.beginPath();
  ctx.moveTo(x, 0); ctx.lineTo(x, C.height); ctx.stroke();

  draw();

  point(x, y);

  if (idx > 190) {
    ctx.fillText(hist[idx].wds + ' words', x+3, y-75);
    ctx.fillText('at ' + hist[idx].when, x+3, y-50);
  } else if (idx > 40) {
    ctx.fillText(hist[idx].wds + ' words', x+3, y+25);
    ctx.fillText('at ' + hist[idx].when, x+3, y+50);
  } else {
    ctx.fillText(hist[idx].wds + ' words', x - 180, y-25);
    ctx.fillText('at ' + hist[idx].when, x - 180, y-0);
  }

};

function point(x, y) {
  ctx.strokeStyle = "red";
  ctx.beginPath();
  ctx.arc(x, y, 3, 0, 7, false);
  ctx.arc(x, y, 7, 0, 7, false);
  ctx.stroke();
}

function nearest(x) {
  var idx0 = 0
    , idx1 = hist.length-1
    , idx;

  while (idx0 < idx1) {

    idx = Math.round((idx0 + idx1) / 2);

    if (transX(hist[idx].time) < x)
      idx1 = idx;
    else
      idx0 = idx;

    if (idx0 == idx1 - 1) return idx1;

  }

  return idx0;
}

</script>
